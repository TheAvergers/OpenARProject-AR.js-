<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR.js Project Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
        }

        canvas {
            display: block;
        }

        .dg.main {
            position: absolute !important;
            top: 60px !important;
            right: 10px !important;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex flex-col h-screen">
        <header class="bg-blue-600 text-white p-4">
            <h1 class="text-2xl font-bold">AR.js Project Editor</h1>
        </header>
        <main class="flex-grow relative">
            <div id="canvas-container" class="absolute inset-0"></div>
            <div class="absolute top-4 right-4 space-y-2">
                <button id="addCubeBtn" class="bg-green-500 text-white px-4 py-2 rounded">Add Cube</button>
                <button id="addSphereBtn" class="bg-red-500 text-white px-4 py-2 rounded">Add Sphere</button>
                <button id="exportButton" class="bg-yellow-500 text-white px-4 py-2 rounded">Export AR.js Code</button>
            </div>
        </main>
        <div id="codeOutput" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
            <div class="bg-white p-4 rounded-lg max-w-3xl w-full max-h-[80vh] overflow-auto">
                <h2 class="text-xl font-bold mb-2">Exported AR.js Code</h2>
                <pre id="codeText" class="bg-gray-100 p-4 rounded"></pre>
                <div class="mt-4 flex justify-end">
                    <button id="copyCodeBtn" class="bg-blue-500 text-white px-4 py-2 rounded mr-2">Copy Code</button>
                    <button id="closeCodeBtn" class="bg-gray-500 text-white px-4 py-2 rounded">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        let scene, camera, renderer, grid;
        let objects = [];
        let gui;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Add grid
            grid = new THREE.GridHelper(10, 10);
            scene.add(grid);

            // Add light
            const light = new THREE.PointLight(0xffffff, 1, 100);
            light.position.set(0, 10, 0);
            scene.add(light);

            camera.position.z = 5;
            camera.position.y = 5;
            camera.lookAt(0, 0, 0);

            setupGUI();
            setupEventListeners();

            animate();
        }

        function setupGUI() {
            gui = new dat.GUI();
            gui.domElement.id = 'gui';
        }

        function setupEventListeners() {
            document.getElementById('addCubeBtn').addEventListener('click', addCube);
            document.getElementById('addSphereBtn').addEventListener('click', addSphere);
            document.getElementById('exportButton').addEventListener('click', exportARCode);
            document.getElementById('copyCodeBtn').addEventListener('click', copyCode);
            document.getElementById('closeCodeBtn').addEventListener('click', closeCodeOutput);
            window.addEventListener('resize', onWindowResize);
        }

        function addCube() {
            const geometry = new THREE.BoxGeometry();
            const material = new THREE.MeshPhongMaterial({ color: 0x00ff00 });
            const cube = new THREE.Mesh(geometry, material);
            scene.add(cube);
            objects.push(cube);
            addObjectControls(cube);
        }

        function addSphere() {
            const geometry = new THREE.SphereGeometry(0.5, 32, 32);
            const material = new THREE.MeshPhongMaterial({ color: 0xff0000 });
            const sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);
            objects.push(sphere);
            addObjectControls(sphere);
        }

        function addObjectControls(object) {
            const objectFolder = gui.addFolder(`Object ${objects.length}`);
            objectFolder.add(object.position, 'x', -5, 5);
            objectFolder.add(object.position, 'y', 0, 5);
            objectFolder.add(object.position, 'z', -5, 5);
            objectFolder.add(object.rotation, 'x', 0, Math.PI * 2);
            objectFolder.add(object.rotation, 'y', 0, Math.PI * 2);
            objectFolder.add(object.rotation, 'z', 0, Math.PI * 2);
            objectFolder.add(object.scale, 'x', 0.1, 2);
            objectFolder.add(object.scale, 'y', 0.1, 2);
            objectFolder.add(object.scale, 'z', 0.1, 2);

            // Add color control
            const colorControl = objectFolder.addColor(object.material, 'color');
            colorControl.onChange((value) => {
                if (typeof value === 'string') {
                    object.material.color.setStyle(value);
                } else if (typeof value === 'number') {
                    object.material.color.setHex(value);
                }
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        function exportARCode() {
            let code = '<a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">\n';
            code += '  <a-marker preset="hiro">\n';

            objects.forEach((obj, index) => {
                const type = obj.geometry.type.includes('Box') ? 'box' : 'sphere';
                code += `    <a-${type} position="${obj.position.x.toFixed(2)} ${obj.position.y.toFixed(2)} ${obj.position.z.toFixed(2)}"
                      rotation="${(obj.rotation.x * 180 / Math.PI).toFixed(2)} ${(obj.rotation.y * 180 / Math.PI).toFixed(2)} ${(obj.rotation.z * 180 / Math.PI).toFixed(2)}"
                      scale="${obj.scale.x.toFixed(2)} ${obj.scale.y.toFixed(2)} ${obj.scale.z.toFixed(2)}"
                      color="#${obj.material.color.getHexString()}"></a-${type}>\n`;
            });

            code += '  </a-marker>\n';
            code += '  <a-entity camera></a-entity>\n';
            code += '</a-scene>';

            document.getElementById('codeText').textContent = code;
            document.getElementById('codeOutput').classList.remove('hidden');
        }

        function copyCode() {
            const codeText = document.getElementById('codeText').textContent;
            navigator.clipboard.writeText(codeText).then(() => {
                alert('Code copied to clipboard!');
            });
        }

        function closeCodeOutput() {
            document.getElementById('codeOutput').classList.add('hidden');
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        init();
    </script>
</body>
</html>